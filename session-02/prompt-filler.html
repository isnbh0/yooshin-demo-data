<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>업무 흐름도 프롬프트 생성기</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap');

  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

  :root {
    --ink: #1a1a2e;
    --ink-light: #4a4a5a;
    --ink-muted: #8888a0;
    --surface: #f7f6f3;
    --surface-warm: #efeee9;
    --card: #ffffff;
    --border: #d8d6cf;
    --border-light: #e8e6df;
    --accent: #01579b;
    --accent-light: #e1f5fe;
    --accent-hover: #0277bd;
    --success: #2e7d32;
    --success-bg: #e8f5e9;
    --radius: 6px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,.06);
    --shadow: 0 2px 8px rgba(0,0,0,.08);
    --shadow-lg: 0 4px 16px rgba(0,0,0,.1);
    --font: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
    --mono: 'IBM Plex Mono', 'SF Mono', Consolas, monospace;
  }

  html { font-size: 15px; }

  body {
    font-family: var(--font);
    background: var(--surface);
    color: var(--ink);
    line-height: 1.6;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  /* ── Header ── */
  .header {
    background: var(--card);
    border-bottom: 1px solid var(--border);
    padding: 1.2rem 2rem;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow-sm);
  }

  .header-inner {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .header h1 {
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: -0.01em;
    color: var(--ink);
  }

  .header-tag {
    font-size: 0.72rem;
    font-weight: 500;
    color: var(--accent);
    background: var(--accent-light);
    padding: 0.25rem 0.6rem;
    border-radius: 3px;
    letter-spacing: 0.02em;
    white-space: nowrap;
  }

  /* ── Layout ── */
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem 2rem 3rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    align-items: start;
  }

  /* ── Panel shared ── */
  .panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }

  .panel-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
  }

  .panel-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--ink-light);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .panel-body {
    padding: 1.25rem;
  }

  /* ── Form ── */
  .form-group {
    margin-bottom: 1.25rem;
  }

  .form-group:last-child {
    margin-bottom: 0;
  }

  .form-label {
    display: block;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--ink);
    margin-bottom: 0.4rem;
  }

  .form-hint {
    font-size: 0.82rem;
    color: var(--ink-muted);
    margin-bottom: 0.4rem;
    line-height: 1.5;
  }

  .form-input,
  .form-textarea {
    width: 100%;
    font-family: var(--font);
    font-size: 0.9rem;
    color: var(--ink);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 0.6rem 0.8rem;
    transition: border-color 0.15s, box-shadow 0.15s;
    outline: none;
  }

  .form-input:focus,
  .form-textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(1,87,155,.1);
  }

  .form-input::placeholder,
  .form-textarea::placeholder {
    color: var(--ink-muted);
  }

  .form-textarea {
    resize: vertical;
    line-height: 1.6;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .form-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }

  .btn-clear {
    font-family: var(--font);
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--ink-muted);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 0.4rem 0.9rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-clear:hover {
    color: var(--ink-light);
    border-color: var(--ink-muted);
  }

  .btn-example {
    font-family: var(--font);
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--accent);
    background: var(--accent-light);
    border: 1px solid transparent;
    border-radius: var(--radius);
    padding: 0.4rem 0.9rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-example:hover {
    border-color: var(--accent);
  }

  .panel-header-actions {
    display: flex;
    gap: 0.4rem;
  }

  /* ── Confirm overlay ── */
  .confirm-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(26,26,46,.35);
    z-index: 200;
    align-items: center;
    justify-content: center;
  }

  .confirm-overlay.visible {
    display: flex;
  }

  .confirm-box {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    padding: 1.5rem;
    max-width: 380px;
    width: 90%;
  }

  .confirm-box p {
    font-size: 0.88rem;
    line-height: 1.6;
    margin-bottom: 1.1rem;
    color: var(--ink);
  }

  .confirm-box .confirm-warn {
    font-size: 0.78rem;
    color: var(--ink-muted);
    margin-bottom: 1.1rem;
  }

  .confirm-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
  }

  .btn-confirm-cancel {
    font-family: var(--font);
    font-size: 0.82rem;
    font-weight: 500;
    color: var(--ink-muted);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 0.45rem 1rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-confirm-cancel:hover {
    color: var(--ink-light);
    border-color: var(--ink-muted);
  }

  .btn-confirm-ok {
    font-family: var(--font);
    font-size: 0.82rem;
    font-weight: 500;
    color: #fff;
    background: var(--accent);
    border: none;
    border-radius: var(--radius);
    padding: 0.45rem 1rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-confirm-ok:hover {
    background: var(--accent-hover);
  }

  /* ── Output panel ── */
  .output-col {
    position: sticky;
    top: calc(3.6rem + 1.5rem);
    max-height: calc(100vh - 3.6rem - 3rem);
    display: flex;
    flex-direction: column;
  }

  .output-panel {
    display: flex;
    flex-direction: column;
    max-height: 100%;
    overflow: hidden;
  }

  .output-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-copy {
    font-family: var(--font);
    font-size: 0.8rem;
    font-weight: 500;
    color: #fff;
    background: var(--accent);
    border: none;
    border-radius: var(--radius);
    padding: 0.45rem 1rem;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    white-space: nowrap;
  }

  .btn-copy:hover {
    background: var(--accent-hover);
  }

  .btn-copy.copied {
    background: var(--success);
  }

  .btn-copy svg {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
  }

  .char-count {
    font-size: 0.72rem;
    font-family: var(--mono);
    color: var(--ink-muted);
  }

  .output-scroll {
    overflow-y: auto;
    flex: 1;
    min-height: 0;
  }

  .output-content {
    padding: 1.25rem;
    font-size: 0.82rem;
    font-family: var(--mono);
    line-height: 1.7;
    white-space: pre-wrap;
    word-break: break-word;
    color: var(--ink);
    tab-size: 2;
  }

  .output-placeholder {
    padding: 2.5rem 1.5rem;
    text-align: center;
    color: var(--ink-muted);
  }

  .output-placeholder .icon {
    font-size: 2rem;
    margin-bottom: 0.75rem;
    opacity: 0.4;
  }

  .output-placeholder p {
    font-size: 0.85rem;
    line-height: 1.6;
  }

  .output-placeholder .fields-status {
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    align-items: center;
  }

  .field-status {
    font-size: 0.78rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .field-status .dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--border);
    flex-shrink: 0;
  }

  .field-status.filled .dot {
    background: var(--success);
  }

  /* ── Attach note ── */
  .attach-note {
    display: none;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.6rem;
    padding: 0.6rem 0.9rem;
    font-size: 0.82rem;
    color: var(--ink-light);
    background: var(--accent-light);
    border: 1px solid #b3e5fc;
    border-radius: var(--radius);
  }

  .attach-note.visible {
    display: flex;
  }

  .attach-note svg {
    width: 15px;
    height: 15px;
    flex-shrink: 0;
    color: var(--accent);
  }

  .attach-note a {
    color: var(--accent);
    font-weight: 500;
    text-decoration: none;
  }

  .attach-note a:hover {
    text-decoration: underline;
  }

  /* ── Scrollbar ── */
  .output-scroll::-webkit-scrollbar { width: 6px; }
  .output-scroll::-webkit-scrollbar-track { background: transparent; }
  .output-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  .output-scroll::-webkit-scrollbar-thumb:hover { background: var(--ink-muted); }

  /* ── Responsive ── */
  @media (max-width: 900px) {
    .container {
      grid-template-columns: 1fr;
      padding: 1rem;
    }

    .output-col {
      position: static;
      max-height: none;
    }

    .output-panel {
      max-height: 70vh;
    }

    .header { padding: 1rem; }
    .header h1 { font-size: 1rem; }
  }

  @media (max-width: 600px) {
    html { font-size: 14px; }
    .form-row { grid-template-columns: 1fr; }
    .header-inner { flex-direction: column; align-items: flex-start; gap: 0.4rem; }
  }
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <h1>업무 흐름도 프롬프트 생성기</h1>
    <span class="header-tag">Session 2</span>
  </div>
</header>

<main class="container">

  <!-- ═══ Left: Form ═══ -->
  <div class="panel">
    <div class="panel-header">
      <span class="panel-title">입력</span>
      <div class="panel-header-actions">
        <button class="btn-example" onclick="fillExample()" title="예시 값으로 채우기">예시 채우기</button>
        <button class="btn-clear" onclick="clearAll()" title="모든 필드 초기화">초기화</button>
      </div>
    </div>
    <div class="panel-body">

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="name">이름</label>
          <input class="form-input" type="text" id="name" placeholder="홍길동" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label" for="dept">부서</label>
          <input class="form-input" type="text" id="dept" placeholder="총무부" autocomplete="off">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="topic">만들고 싶은 흐름도 주제</label>
        <div class="form-hint">어떤 업무 프로세스를 다이어그램으로 만들고 싶은지 적어주세요</div>
        <input class="form-input" type="text" id="topic" placeholder="예: 출장 정산, 구매 요청 처리, 계약서 검토" autocomplete="off">
      </div>

      <div class="form-group">
        <label class="form-label" for="context">맥락</label>
        <div class="form-hint">세션 1 과제로 작성한 업무 맥락 문서를 붙여넣기 하세요</div>
        <textarea class="form-textarea" id="context" rows="24" placeholder="업무 맥락 문서 내용을 여기에 붙여넣기..."></textarea>
      </div>

    </div>
  </div>

  <!-- ═══ Right: Output ═══ -->
  <div class="output-col">
    <div class="panel output-panel">
      <div class="panel-header">
        <span class="panel-title">프롬프트</span>
        <div class="output-actions">
          <span class="char-count" id="charCount"></span>
          <button class="btn-copy" id="copyBtn" onclick="copyPrompt()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            <span id="copyLabel">복사</span>
          </button>
        </div>
      </div>
      <div class="output-scroll">
        <div id="output"></div>
      </div>
    </div>
    <div class="attach-note" id="attachNote">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
      <span>이 프롬프트와 함께 <a href="diagram-spec.md" download>업무 흐름도 작성 규격</a> 파일을 첨부하세요</span>
    </div>
  </div>

</main>

<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-box">
    <p>입력한 내용을 예시 값으로 대체할까요?</p>
    <div class="confirm-warn">현재 작성된 내용이 사라집니다.</div>
    <div class="confirm-actions">
      <button class="btn-confirm-cancel" onclick="closeConfirm()">취소</button>
      <button class="btn-confirm-ok" onclick="applyExample()">대체하기</button>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = 'yooshin-s2-prompt-filler';

// ── Elements ──
const $name = document.getElementById('name');
const $dept = document.getElementById('dept');
const $topic = document.getElementById('topic');
const $context = document.getElementById('context');
const $output = document.getElementById('output');
const $charCount = document.getElementById('charCount');
const $copyBtn = document.getElementById('copyBtn');
const $copyLabel = document.getElementById('copyLabel');
const $attachNote = document.getElementById('attachNote');

const fields = [$name, $dept, $topic, $context];

// ── Render ──
function getPromptText() {
  const name = $name.value.trim();
  const dept = $dept.value.trim();
  const topic = $topic.value.trim();
  const context = $context.value.trim();

  return `# 업무 흐름도 작성 요청

## 내 정보
- 이름: ${name}
- 부서: ${dept}

## 만들고 싶은 흐름도
${topic}

## 내 업무 맥락
${context}

---

## 작성 규격

별도로 첨부한 「업무 흐름도 작성 규격」 문서를 반드시 참고하세요.

---

## 진행 방법

첨부된 규격에 맞는 Mermaid 업무 흐름도를 만들어주세요. 아래 절차를 따라주세요:

1. 먼저 내 업무 맥락과 흐름도 주제를 확인한 뒤, 해당 업무의 구체적인 절차에 대해 **인터뷰**해주세요.
2. 한 번에 하나씩 질문하세요. 필요한 정보가 충분히 모일 때까지 계속 질문합니다.
3. 충분한 정보가 모이면, 첨부된 작성 규격에 맞는 Mermaid 다이어그램 코드를 작성해주세요.
4. 다이어그램은 10~15개 노드를 목표로 합니다.
5. 작성 후 각 노드와 연결에 대한 간단한 해설을 덧붙여주세요.`;
}

function isReady() {
  return $name.value.trim() && $dept.value.trim() && $topic.value.trim() && $context.value.trim();
}

function render() {
  if (isReady()) {
    const text = getPromptText();
    $output.className = 'output-content';
    $output.textContent = text;
    $charCount.textContent = text.length.toLocaleString() + '자';
    $copyBtn.style.display = '';
    $attachNote.classList.add('visible');
  } else {
    renderPlaceholder();
    $charCount.textContent = '';
    $copyBtn.style.display = 'none';
    $attachNote.classList.remove('visible');
  }
  save();
}

function renderPlaceholder() {
  const fieldInfo = [
    { id: 'name', label: '이름' },
    { id: 'dept', label: '부서' },
    { id: 'topic', label: '흐름도 주제' },
    { id: 'context', label: '맥락' },
  ];

  let html = '<div class="output-placeholder">';
  html += '<div class="icon">&#9998;</div>';
  html += '<p>왼쪽 양식을 작성하면<br>프롬프트가 자동으로 완성됩니다</p>';
  html += '<div class="fields-status">';
  for (const f of fieldInfo) {
    const el = document.getElementById(f.id);
    const filled = el && el.value.trim();
    html += `<span class="field-status ${filled ? 'filled' : ''}"><span class="dot"></span>${f.label}</span>`;
  }
  html += '</div></div>';
  $output.className = '';
  $output.innerHTML = html;
}

// ── Copy ──
function copyPrompt() {
  if (!isReady()) return;
  const text = getPromptText();
  navigator.clipboard.writeText(text).then(() => {
    $copyBtn.classList.add('copied');
    $copyLabel.textContent = '복사 완료!';
    setTimeout(() => {
      $copyBtn.classList.remove('copied');
      $copyLabel.textContent = '복사';
    }, 2000);
  });
}

// ── Persistence ──
function save() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      name: $name.value,
      dept: $dept.value,
      topic: $topic.value,
      context: $context.value,
    }));
  } catch (e) { /* quota exceeded, ignore */ }
}

function load() {
  try {
    const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
    if (!data) return;
    if (data.name) $name.value = data.name;
    if (data.dept) $dept.value = data.dept;
    if (data.topic) $topic.value = data.topic;
    if (data.context) $context.value = data.context;
  } catch (e) { /* corrupt data, ignore */ }
}

function clearAll() {
  fields.forEach(f => f.value = '');
  localStorage.removeItem(STORAGE_KEY);
  render();
  $name.focus();
}

// ── Example ──
const EXAMPLE = {
  name: '김유신',
  dept: '총무부',
  topic: '사무용품 구매 요청 처리',
  context: `## 업무 개요
총무부에서 각 부서의 사무용품 구매 요청을 접수하고, 승인·발주·검수까지 처리하는 업무입니다.

## 주요 절차
1. 각 부서에서 사무용품 구매 요청서를 작성하여 총무부에 제출
2. 총무부 담당자가 요청 내용과 재고를 확인
3. 건당 50만원 이상은 부서장 승인 필요
4. 승인된 건에 대해 협력업체에 발주
5. 납품 후 검수하고 비용 처리

## 관련 문서/시스템
- 구매 요청서 (사내 양식)
- 재고 관리 대장 (엑셀)
- 구매 승인 품의서
- 거래처 목록
- 검수 확인서

## 특이사항
- 긴급 요청은 구두 승인 후 후결 처리 가능
- 분기별 사무용품 예산 한도 있음`,
};

const $confirmOverlay = document.getElementById('confirmOverlay');

function hasContent() {
  return fields.some(f => f.value.trim());
}

function fillExample() {
  if (hasContent()) {
    $confirmOverlay.classList.add('visible');
  } else {
    applyExample();
  }
}

function closeConfirm() {
  $confirmOverlay.classList.remove('visible');
}

function applyExample() {
  $confirmOverlay.classList.remove('visible');
  $name.value = EXAMPLE.name;
  $dept.value = EXAMPLE.dept;
  $topic.value = EXAMPLE.topic;
  $context.value = EXAMPLE.context;
  render();
}

$confirmOverlay.addEventListener('click', (e) => {
  if (e.target === $confirmOverlay) closeConfirm();
});

// ── Init ──
fields.forEach(f => f.addEventListener('input', render));
load();
render();
</script>
</body>
</html>
